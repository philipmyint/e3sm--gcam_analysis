# e3sm--gcam_analysis
## Getting Started
Scripts for plotting and analyzing outputs from coupled E3SM and GCAM simulations. The scripts can be run on a local machine (i.e., a personal laptop) as well as on DOE high-performance clusters like Chrysalis. 

### Overview of directories
- `scripts`: Contains the scripts. All but one of which are in Python, with the lone exception being in R. Each script can be run by entering `python [script_name].py [json_file].json` or `Rscript [script_name].R [json_file].json` on the command line. Here, the JSON file that is run together with script indicates user options for creating the plots or performing the analysis executed by the script. The scripts can take in arbitrary number of JSON files specified on the command line, so the user options can be split up over multiple JSON files if desired. The user does not need to modify any of the scripts to run them; the intention is for them to modify only the corresponding JSON file(s). There is also a `docs` subdirectory that contains user-friendly docstring-generated HTML files for the Python scripts.
- `2025_DiVittorio_et_al_e3sm`: Contains outputs extracted from E3SM. When running the scripts included in this repository (see more details below), the plots and analysis files generated by those scripts will appear in this directory as well. This directory contains some files already; these files are extracted from E3SM outputs on Chrysalis using the scripts `e3sm_extract_spatial_data_h0.py`, `e3sm_extract_time_series_h0.py`, and `e3sm_extract_time_series_surfdata_iesm_dyn.py` scripts described further below. The extracted outputs are included as part of the repo so that the examples in the scripts are readily runnable on local machines or other DOE clusters, without the hassle of requiring the user to first extract the outputs on Chrysalis.
- `2025_DiVittorio_et_al_gcam`: Contains outputs extracted from GCAM. Much like the case with E3SM outputs, the GCAM directory already contains pre-extracted data and files from various output folders on Chrysalis, allowing the examples in the scripts to be runnable on other machines besides Chrysalis. This pre-extracted data include shape files and relevant geographical data on the GCAM regions and basins, a set of files containing soil and vegetation scalars from earlier runs, and a couple of project files from earlier runs. 
- `output_headers`: Contains text files for the headers from E3SM NetCDF file types used in this repo (for ease of reference).
- `scripts_from_others`: Contains Python and R scripts used for previous E3SM--GCAM analysis.

### Installation
Python and R are required to run the scripts. The `e3sm_unified` Conda environment ([https://docs.e3sm.org/e3sm_diags/_build/html/v2.10.1/install.html](https://docs.e3sm.org/e3sm_diags/_build/html/v2.10.1/install.html) that is available on machines like Chrysalis is sufficient for Python. On other machines, the following libraries/modules/packages may need to be installed to supplement the base Python standard library (though this is likely not an exhaustive list; install additional dependencies as necessary):
- `numpy`
- `scipy`
- `pandas`
- `geopandas`
- `xarray`
- `uxarray`
- `matplotlib`
- `seaborn`
One of the scripts in the repo, `gcam_extract_csv_from_project_files.R`, is based on R. For this script, the following libraries and packages, plus their dependencies, must be installed:
- `devtools`
- `dplyr`
- `rgcam`
- `rjson`
Finally, one can also optionally install $${\textrm{\LaTeX}}$$. The examples that are currently in the scripts assume that it has been installed so that $${\textrm{\LaTeX}}$$ is used to typeset the axis labels and titles in the plots. However, the default option in the scripts is actually to not use $${\textrm{\LaTeX}}$$, so one can just delete the `use latex: true` lines in the scripts if $${\textrm{\LaTeX}}$$ is not installed or not desired.

## E3SM scripts
### Description
The following is a brief description of the scripts for plotting and analyzing E3SM output. To test out these scripts, run them on the command line with the JSON files that share the same name:
- `e3sm_extract_spatial_data_h0.py`:

### TODO:
- Extraction of time series and spatial data from h0 files if the h0 files are printed out at arbitrary time intervals (not just months). 
- Add ability to plot spatial distribution of PFT categories (individual types and aggregated subgroups) and land unit types (e.g., vegetation fraction). Right now, can only make time series plots of PFT categories and land unit types.

## GCAM scripts
### Descript

